"use strict";var execSync=require("child_process").execSync;var fs=require("fs");var path=require("path");var dateFormat=function t(e,r){var n=void 0;var c={"Y+":r.getFullYear().toString(),"m+":(r.getMonth()+1).toString(),"d+":r.getDate().toString(),"H+":r.getHours().toString(),"M+":r.getMinutes().toString(),"S+":r.getSeconds().toString()};for(var i in c){n=new RegExp("("+i+")").exec(e);if(n){e=e.replace(n[1],n[1].length===1?c[i]:c[i].padStart(n[1].length,"0"))}}return e};var BranchPlugin=function t(e){e=e||{};this.options=e};BranchPlugin.prototype.apply=function(m){var l=this;m.hooks.afterEmit.tap("branch-plugin",function(){var t="\n",e="\n",r="\n",n="\n",c="\n",i="\n";try{e=process.env["npm_lifecycle_script"].toString().trim()}catch(t){}try{t=execSync("git rev-parse --abbrev-ref HEAD")}catch(t){}try{r=execSync("git config user.name")}catch(t){}try{n=execSync("git config user.email")}catch(t){}try{c=dateFormat("YYYY-mm-dd HH:MM:SS",new Date)}catch(t){}i="资源包提供者:"+r+"执行脚本:"+e+"\n邮箱:"+n+"生成日期:"+c+"\n发布分支:"+t+new Array(80).join("*")+"\n";var a="",o="",g="",s="",h="",S="";try{a=execSync("git show -s --format=%H").toString().trim()}catch(t){}try{o=execSync("git show -s --format=%cn").toString().trim()}catch(t){}try{g=execSync("git show -s --format=%ce").toString().trim()}catch(t){}try{s=new Date(execSync("git show -s --format=%cd").toString())}catch(t){}try{h=execSync("git show -s --format=%s").toString().trim()}catch(t){}if(a||o||g||s||h){S="最近一次提交:\ngit:"+a+"\n作者:"+o+"<"+g+">\n日期:"+(s.getFullYear()+"-"+(s.getMonth()+1)+"-"+s.getDate()+" "+s.getHours()+":"+s.getMinutes())+"\n说明:"+h+"\n"+new Array(80).join("*")+"\n"}var y=m.options.output||{},u=y.path;var f=l.options||{},p=f.filename;if(!p.startsWith("/")){p="/"+p}try{fs.writeFileSync(path.join(u+p),i+S,{encoding:"utf-8",mode:438,flag:"w"})}catch(t){}})};module.exports=BranchPlugin;