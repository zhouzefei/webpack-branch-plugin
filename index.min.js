"use strict";var execSync=require("child_process").execSync;var fs=require("fs");var dateFormat=function t(n,e){var r=void 0;var i={"Y+":e.getFullYear().toString(),"m+":(e.getMonth()+1).toString(),"d+":e.getDate().toString(),"H+":e.getHours().toString(),"M+":e.getMinutes().toString(),"S+":e.getSeconds().toString()};for(var o in i){r=new RegExp("("+o+")").exec(n);if(r){n=n.replace(r[1],r[1].length==1?i[o]:i[o].padStart(r[1].length,"0"))}}return n};var BranchPlugin=function t(n){n=n||{};this.options=n};BranchPlugin.prototype.apply=function(h){var l=this;h.hooks.afterEmit.tap("branch-plugin",function(){var t=execSync("git name-rev --name-only HEAD",{encoding:"utf8"});var n=execSync("git config user.name",{encoding:"utf8"});var e=execSync("git config user.email",{encoding:"utf8"});var r=dateFormat("YYYY-mm-dd HH:MM:SS",new Date);var i="发布者:"+n+"邮箱:"+e+"发布日期:"+r+"\n发布分支:"+t+new Array(80).join("*")+"\n";var o=execSync("git show -s --format=%H").toString().trim();var a=execSync("git show -s --format=%cn").toString().trim();var c=execSync("git show -s --format=%ce").toString().trim();var g=new Date(execSync("git show -s --format=%cd").toString());var s=execSync("git show -s --format=%s").toString().trim();var u="最近一次提交:\ngit:"+o+"\n作者:"+a+"<"+c+">\n日期:"+(g.getFullYear()+"-"+(g.getMonth()+1)+"-"+g.getDate()+" "+g.getHours()+":"+g.getMinutes())+"\n说明:"+s+"\n"+new Array(80).join("*")+"\n";var S=h.options.output||{},f=S.path;var v=l.options||{},m=v.filename;if(!m.startsWith("/")){m="/"+m}fs.writeFileSync(f+m,i+u,function(t){if(t){console.warn(t)}})})};module.exports=BranchPlugin;